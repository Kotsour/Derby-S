<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8" />
<title>Derby pražských S</title>
<style>
  body {
    margin:0; padding:0; background:#0a3d1d;
    display:flex; justify-content:center; align-items:center; height:100vh;
    font-family: Arial, sans-serif;
    color: white;
  }
  canvas {
    background: linear-gradient(to bottom, #1e662a, #3a8a3f);
    border: 4px solid #eee;
    border-radius: 10px;
  }
  #scoreboard {
    position: fixed;
    top: 10px; left: 10px;
    font-size: 18px;
  }
  #highscoreboard {
    position: fixed;
    top: 40px; left: 10px;
    font-size: 16px;
    color: #ffcc00;
  }
</style>
</head>
<body>
<div id="scoreboard">Skóre: 0</div>
<div id="highscoreboard">Nejvyšší skóre: 0</div>
<canvas id="game" width="400" height="400"></canvas>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const grid = 20;
const rows = canvas.height / grid;
const cols = canvas.width / grid;

let count = 0;
let score = 0;
let highScore = localStorage.getItem('derbyHighscore') || 0;

document.getElementById('highscoreboard').textContent = 'Nejvyšší skóre: ' + highScore;

const kocour = {
  x: 10,
  y: 10,
  dx: 0,
  dy: 0,
  cells: [],
  maxCells: 4
};

const krysa = {
  x: 15,
  y: 15
};

const zvukPlak = new Audio('https://actions.google.com/sounds/v1/human/child_crying.ogg');
const zvukGameOver = new Audio('https://actions.google.com/sounds/v1/alarms/beep_short.ogg');

function getRandomInt(min, max) {
  return Math.floor(Math.random() * (max - min)) + min;
}

function drawKocour(x, y) {
  const size = grid - 2;
  ctx.fillStyle = 'red';
  ctx.fillRect(x * grid + 1, y * grid + 1, size/2, size);
  ctx.fillStyle = 'white';
  ctx.fillRect(x * grid + 1 + size/2, y * grid + 1, size/2, size);
  ctx.fillStyle = 'red';
  ctx.fillRect(x * grid + size/4, y * grid + 1 - size/2 + 4, size/2, size/2);
  ctx.fillStyle = 'black';
  ctx.fillRect(x * grid + size/3, y * grid + 4, 3, 3);
  ctx.fillRect(x * grid + size/2, y * grid + 4, 3, 3);
  ctx.fillStyle = 'red';
  ctx.fillRect(x * grid + size - 4, y * grid + size/2, 5, 2);
}

function drawKrysa(x, y) {
  const size = grid - 2;
  ctx.fillStyle = '#a80000';
  ctx.fillRect(x * grid + 1, y * grid + 1, size, size);
  ctx.fillStyle = 'black';
  ctx.fillRect(x * grid + size/3, y * grid + 4, 3, 3);
}

function resetGame() {
  alert('Konec hry! Tvoje skóre: ' + score);
  if(score > highScore){
    highScore = score;
    localStorage.setItem('derbyHighscore', highScore);
    document.getElementById('highscoreboard').textContent = 'Nejvyšší skóre: ' + highScore;
  }
  score = 0;
  document.getElementById('scoreboard').textContent = 'Skóre: ' + score;
  kocour.x = 10;
  kocour.y = 10;
  kocour.dx = 0;
  kocour.dy = 0;
  kocour.cells = [];
  kocour.maxCells = 4;
  krysa.x = getRandomInt(0, cols);
  krysa.y = getRandomInt(0, rows);
  zvukGameOver.play();
}

document.addEventListener('keydown', function(e){
  if(e.key === 'ArrowLeft' && kocour.dx === 0){
    kocour.dx = -1;
    kocour.dy = 0;
  } else if(e.key === 'ArrowUp' && kocour.dy === 0){
    kocour.dx = 0;
    kocour.dy = -1;
  } else if(e.key === 'ArrowRight' && kocour.dx === 0){
    kocour.dx = 1;
    kocour.dy = 0;
  } else if(e.key === 'ArrowDown' && kocour.dy === 0){
    kocour.dx = 0;
    kocour.dy = 1;
  }
});

function gameLoop(){
  requestAnimationFrame(gameLoop);
  if(++count < 6){
    return;
  }
  count = 0;
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  kocour.x += kocour.dx;
  kocour.y += kocour.dy;

  if(kocour.x < 0 || kocour.x >= cols || kocour.y < 0 || kocour.y >= rows){
    resetGame();
  }

  kocour.cells.unshift({x: kocour.x, y: kocour.y});

  if(kocour.cells.length > kocour.maxCells){
    kocour.cells.pop();
  }

  for(let i = 1; i < kocour.cells.length; i++){
    if(kocour.x === kocour.cells[i].x && kocour.y === kocour.cells[i].y){
      resetGame();
    }
  }

  drawKrysa(krysa.x, krysa.y);

  kocour.cells.forEach(cell => drawKocour(cell.x, cell.y));

  if(kocour.x === krysa.x && kocour.y === krysa.y){
    kocour.maxCells++;
    score++;
    document.getElementById('scoreboard').textContent = 'Skóre: ' + score;
    krysa.x = getRandomInt(0, cols);
    krysa.y = getRandomInt(0, rows);
    zvukPlak.play();
  }
}

requestAnimationFrame(gameLoop);
</script>
</body>
</html>
